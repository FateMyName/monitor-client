<html>
<head>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script
            type="text/javascript"
            src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"
    ></script>

    <style>
        #mynetwork {
            width: 100%;
            height: 100vh;
        }
    </style>
</head>
<body>
<div id="mynetwork"></div>

<script type="text/javascript">
    function htmlTitle(html) {
        const container = document.createElement("div");
        container.innerHTML = html;
        return container;
    }
    async function start() {
        let VW = Math.max(document.documentElement.clientWidth, window.innerWidth || 0)
        let VH = Math.max(
            document.documentElement.clientHeight,
            window.innerHeight || 0
        )
        console.log(VW, VH)
        let res = await axios.get(`http://localhost:3000/api/mock?count=10000&width=${VW}&height=${VH}`)
        let activeNodes = res.data.map((n) => ({
            id: parseInt(n.nodeId.substr(0, 8), 16),
            x: n.position.x,
            y: n.position.y,
            physics: false,
            title: htmlTitle(`
            <p><strong>NodeId</strong>: ${n.nodeId}</p>
            <p><strong>IP Address</strong>: ${n.nodeIpInfo.externalIp}:${n.nodeIpInfo.externalPort}</p>
            <p><strong>NodeList Hash</strong>: ${n.nodelistHash}</p>
            <p><strong>CycleMaker Hash</strong>: ${n.cycleMarker}</p>
            `),
            color: {
                border: `#${n.appState.substr(0,6)}`,
                background: `#${n.appState.substr(0,6)}`,
                highlight: {
                    border: `#${n.appState.substr(0,6)}`,
                    background: `#${n.appState.substr(0,6)}`
                },
                hover: {
                    border: `#${n.appState.substr(0,6)}`,
                    background: `#${n.appState.substr(0,6)}`
                }
            },
            interaction: {
                tooltipDelay: 200,
                hideEdgesOnDrag: true,
            },
        }))
        console.log('activeNodes', activeNodes)
        let nodes = new vis.DataSet(activeNodes)
        console.log("nodes", nodes)

        // let nodes = new vis.DataSet([
        //     {id: 1, label: 'Node 1', x: 0, y:0, physics: false},
        //     {id: 2, label: 'Node 2'},
        //     {id: 3, label: 'Node 3'},
        //     {id: 4, label: 'Node 4'},
        //     {id: 5, label: 'Node 5'}
        // ])

        // var edges = new vis.DataSet([
        //     { from: 1, to: 3 },
        //     { from: 1, to: 2 },
        //     { from: 2, to: 4 },
        //     { from: 2, to: 5 },
        // ])

        // create a network
        const container = document.getElementById('mynetwork')

        // provide the data in the vis format
        var data = {
            nodes: nodes,
            // edges: edges
        }
        var options = {
            nodes: {
                shape: 'dot',
                size: 3,
                // scaling: {
                //     min: 3,
                //     max: 3,
                // },
                font: {
                    size: 12,
                    face: 'Tahoma',
                },
            },
        }

        // initialize your network!
        var network = new vis.Network(container, data, options)
    }
    start()
</script>
</body>
</html>
